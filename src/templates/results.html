{% extends "base.html" %} {% block content %}
<div class="row justify-content-center">
  <div class="col-md-8">
    <!-- Header Section -->
    <div class="d-flex justify-content-between align-items-end mb-4">
      <div>
        <h2 class="mb-0">
          Conjugations for:
          <span class="text-primary">{{ verb.infinitive }}</span>
        </h2>
        <p class="text-muted">{{ mode }} - {{ tense }}</p>
      </div>
      <div class="text-end">
        <div class="bg-light p-2 rounded border mb-2 d-inline-block text-start">
          <div class="form-check form-switch m-0">
            <input
              class="form-check-input"
              type="checkbox"
              role="switch"
              id="skipCheck"
              checked
            />
            <label
              class="form-check-label fw-bold small"
              for="skipCheck"
              style="cursor: pointer"
            >
              Skip tu / v√≥s
            </label>
          </div>
        </div>
        <br />
        <button onclick="downloadCSV()" class="btn btn-success">
          Download CSV
        </button>
        <a href="/" class="btn btn-outline-secondary ms-2">New Search</a>
      </div>
    </div>

    <!-- Table Section -->
    <div class="card shadow">
      <div class="table-responsive">
        <table class="table table-hover mb-0">
          <thead class="table-light">
            <tr>
              <th>Person</th>
              <th>Conjugation</th>
            </tr>
          </thead>
          <tbody>
            {% for conj in conjugations %}
            <tr>
              <td class="text-muted italic">{{ conj.person.name }}</td>
              <td class="fw-bold">{{ conj.value }}</td>
            </tr>
            {% else %}
            <tr>
              <td colspan="2" class="text-center">
                No results found for this specific mode/tense.
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>

<!-- JavaScript logic at the bottom of the content block -->
<script>
  function downloadCSV() {
    console.log("Download triggered...");
    const skip = document.getElementById("skipCheck").checked;

    // Construct the base URL using Jinja2
    // url_for generates a path like "/export/comer?mode=Indicativo&tense=Presente"
    const basePath =
      "{{ url_for('main.export_csv', verb_infinitive=verb.infinitive, mode=mode, tense=tense) }}";

    // Use the built-in URL API to handle parameters safely
    const url = new URL(basePath, window.location.origin);

    if (skip) {
      url.searchParams.append("skip_tu_vos", "true");
    }

    console.log("Redirecting to:", url.href);
    window.location.href = url.href;
  }
</script>
{% endblock %}
